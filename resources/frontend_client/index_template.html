<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="apple-touch-icon" sizes="180x180" href="/app/assets/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/app/assets/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/app/assets/img/favicon-16x16.png">
    <link rel="manifest" href="/app/assets/img/site.webmanifest">
    <link rel="mask-icon" href="/app/assets/img/safari-pinned-tab.svg" color="#62a8e6">
    <link rel="shortcut icon" href="/app/assets/img/favicon.ico">
    <meta name="msapplication-TileColor" content="#2d89ef">
    <meta name="msapplication-config" content="/app/assets/img/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="base-href" content="{{{baseHref}}}" />
    <meta name="uri" content="{{{uri}}}" />

    {{{embedCode}}}

    <title>Metabase</title>

    <base href="{{{baseHref}}}" />

    <script type="application/json" id="_metabaseBootstrap">
      {{{bootstrapJSON}}}
    </script>

    <script type="application/json" id="_metabaseLocalization">
      {{{localizationJSON}}}
    </script>

    <!-- If you modify this script, make sure you update the whitelisted Content-Security-Policy hash in metabase.middleware.security -->
    <script type="text/javascript">{{{bootstrapJS}}}</script>
  </head>

  <body>

  <!-- STRATIO -->
  <script type="text/javascript">
            function setCookie(name, value, expires, path, secure) {
              var today = new Date();
              today.setTime(today.getTime());
              if (expires) {
                expires = expires * 1000 * 60 * 60 * 24;
              }
              var expires_date = new Date(today.getTime() + (expires));
              document.cookie = name + '=' + escape(value) +
                ((expires) ? ';expires=' + expires_date.toGMTString() : '') + //expires.toGMTString()
                ((path) ? ';path=' + path : '') +
                ((secure) ? ';secure' : '');
            }
            function request(url, cFunction) {
              var xhttp;
              xhttp=new XMLHttpRequest();
              xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                  return cFunction(this);
                }
              };
              xhttp.open("POST", url, true);
              xhttp.setRequestHeader("Content-Type", "application/json");
              xhttp.send(JSON.stringify({username:"aa@gmail.com", password:"bbbbb"}));
            }
            function setCookieMetabase(sessionId) {
                var METABASE_SESSION_COOKIE = 'metabase.SESSION_ID';
                try {
                    if (sessionId) {
                        // set a session cookie
                        setCookie(METABASE_SESSION_COOKIE, sessionId, "/", true);
                    }
                } catch (e) {
                    console.error("setSessionCookie:", e);
                }
            }
            function myFunction(xhttp) {
              var myArr = JSON.parse(xhttp.responseText);
              if (myArr.id) {
                setCookieMetabase(myArr.id);
                document.location = document.location;
                return true;
              } else {
                return false;
              }
            }
            function getCookie(name) {
                name = name + "=";
                var cookies = document.cookie.split(';');
                for(var i = 0; i <cookies.length; i++) {
                    var cookie = cookies[i];
                    while (cookie.charAt(0)==' ') {
                        cookie = cookie.substring(1);
                    }
                    if (cookie.indexOf(name) == 0) {
                        return cookie.substring(name.length,cookie.length);
                    }
                }
                return "";
            }
            var session = getCookie('metabase.SESSION_ID');
            if (session.length==0){
                request('api/session', myFunction);
            }
        </script>
    <!-- FIN STRATIO -->

    <div id="root"></div>

    <!-- Using the Web Font Loader lets us load the fonts asynchronously for faster page loads -- see https://github.com/typekit/webfontloader -->
    <!-- If you modify this script, make sure you update the whitelisted Content-Security-Policy hash in metabase.middleware.security -->
    <script type="text/javascript">{{{webFontConfigJS}}}</script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" async></script>

    <!-- If Google Auth is enabled load the Google Auth JS lib -->
    {{#enableGoogleAuth}}
      <script type="text/javascript" src="https://apis.google.com/js/api:client.js" async></script>
    {{/enableGoogleAuth}}

    <!-- Google Analytics -->
    <!-- If you modify this script, make sure you update the whitelisted Content-Security-Policy hash in metabase.middleware.security -->
    {{#enableAnonTracking}}
      <script type="text/javascript">{{{googleAnalyticsJS}}}</script>
    {{/enableAnonTracking}}
  </body>
</html>
